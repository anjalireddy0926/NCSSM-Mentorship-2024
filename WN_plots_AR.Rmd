---
title: "WN"
output: html_notebook
---


```{r setup}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
install.packages("AICcmodavg")

library(tidyverse)
library(cowplot)
library(gplots)
library(ggplot2)
library(patternplot)
library(lme4)
library(visreg)
library(tidyr)
library(magrittr) 
library(dplyr)
library(ggpubr)
library(lme4)
library(lsmeans)
library(emmeans)
library(rstatix)
library(ggstatsplot)
library(palmerpenguins)
library(AICcmodavg)
library(afex)
library(xlsx)


```


# Read in merged_MWM sheet and AWN data


mwm_data<-read.csv('merged_MWM_hsm_090123.csv', header=TRUE)

#mwm_data<-read.csv('mwm_data_ab.csv', header=TRUE)

mwm_data$Age_handling_mastersheet = as.numeric(mwm_data$Age_handling_mastersheet)
# setting age groups
mwm_data<-mwm_data %>% 
  mutate(Age_group = case_when(
    #Age_handling_mastersheet < 7 ~ '6 Months',
    Age_handling_mastersheet >= 7 & Age_handling_mastersheet <= 14 ~ 'Young',
    Age_handling_mastersheet > 14 ~ 'Old'
#   TRUE ~ 'Young'
  ))

mwm_data<-mwm_data %>% 
  mutate(Sex = Sex_mastersheet
  )

mwm_data<-mwm_data %>% 
  mutate(Genotype = Genotype_mastersheet
  )
  
mwm_data<-mwm_data %>% 
  mutate(Diet = Diet_mastersheet
  )


# AWN reading


data1<-read.csv('Winding/190617MWM_positions.csv', header=TRUE)
data1$Row = gsub ( "061019", "190610", data1$Row)
data2<-read.csv('Winding/190715MWM_positions.csv', header=TRUE)
data3<-read.csv('Winding/190919MWM_positions.csv', header=TRUE)
data4<-read.csv('Winding/200302MWM_positions.csv', header=TRUE)
data5<-read.csv('Winding/200331MWM_positions.csv', header=TRUE)
data6<-read.csv('Winding/201016MWM_positions.csv', header=TRUE)
data7<-read.csv('Winding/210112MWM_positions.csv', header=TRUE)
data8<-read.csv('Winding/210118MWM_positions.csv', header=TRUE)
data8$Row = gsub ( "210118", "201012", data8$Row)
data9<-read.csv('Winding/210201MWM_positions.csv', header=TRUE)
data10<-read.csv('Winding/210222MWM_positions.csv', header=TRUE)
data11<-read.csv('Winding/210503MWM_positions.csv', header=TRUE)
data12<-read.csv('Winding/210614MWM_positions.csv', header=TRUE)
data13<-read.csv('Winding/210811MWM_positions.csv', header=TRUE)
data14<-read.csv('Winding/210906MWM_positions.csv', header=TRUE)
data15<-read.csv('Winding/211004MWM_positions.csv', header=TRUE)
data16<-read.csv('Winding/211122MWM_positions.csv', header=TRUE)
data17<-read.csv('Winding/220110MWM_positions.csv', header=TRUE)
data18<-read.csv('Winding/220207MWM_positions.csv', header=TRUE)
data19<-read.csv('Winding/220307MWM_positions.csv', header=TRUE)
data20<-read.csv('Winding/220404MWM_positions.csv', header=TRUE)

#data21<-read.csv('Winding/220422MWM_positions.csv', header=TRUE)#data21<-read.csv('Winding/220422MWM_positions.csv', header=TRUE)
data21<-read.csv('Winding/191028MWM_positions.csv', header=TRUE)

data22<-read.csv('Winding/220509MWM_positions.csv', header=TRUE)
data23<-read.csv('Winding/220606MWM_positions.csv', header=TRUE)
data24<-read.csv('Winding/220704MWM_positions.csv', header=TRUE)
data25<-read.csv('Winding/220808MWM_positions.csv', header=TRUE)
data26<-read.csv('Winding/220905MWM_positions.csv', header=TRUE)
data27<-read.csv('Winding/221003MWM_positions.csv', header=TRUE)
data28<-read.csv('Winding/221101MWM_positions.csv', header=TRUE)
data29<-read.csv('Winding/221128MWM_positions.csv', header=TRUE)
data30<-read.csv('Winding/230117MWM_positions.csv', header=TRUE)


# Need to fix file name format
data31<-read.csv('Winding/230213MWM_positions.csv', header=TRUE)

data32<-read.csv('Winding/230313MWM_positions.csv', header=TRUE)
data33<-read.csv('Winding/230410MWM_positions.csv', header=TRUE)
data34<-read.csv('Winding/230508MWM_positions.csv', header=TRUE)
data35<-read.csv('Winding/230605MWM_positions.csv', header=TRUE)



# AWN combining
wn<-rbind(data1,data2,data3,data4,data5,data6,data7,data8,data9,data10,data11,
          data12,data13,data14,data15,data16,data17,data18,data19, data20, data21,
          data22, data23, data24, data25, data26, data27, data28, data29, data30, 
          data31, data3, data33, data34, data35)

# creating column with cohort ID and stage and time
wn['CohortID']=as.integer(substr(wn$Row, 1, 6))
wn$AnimalID=substr(wn$Row, 1, 9)

index_temp = substr(wn$AnimalID,9,9) == "_"
wn$AnimalID[index_temp] = substr(wn$AnimalID[index_temp],1,8)
wn$AnimalID = gsub("-" , "_", wn$AnimalID)


n_last_time <- 15                                # Specify number of characters to extract
wn$Time=as.integer(substr(wn$Row, nchar(wn$Row)-n_last_time+1, nchar(wn$Row)-n_last_time+1))

n_last_stage <- 21
wn$Stage<-substr(wn$Row, nchar(wn$Row) - n_last_stage + 1, nchar(wn$Row)-n_last_stage+4)

#index_probe = grep("e", wn$AnimalID)
wn$Stage = gsub('e', 'Probe', wn$Stage)

#write.csv(wn, '/Users/AnnaMacFarlane/Desktop/CombinedAWN.csv')

# reading in other MWM data 

#mwm_data<-read.csv('mwm_data.csv', header=TRUE)
#mwm_data<-subset(mwm_data, select=-c(X, age))

# merging data 
mwm_data <- left_join(wn, mwm_data, by = c("AnimalID" = "Animal", "Time"="Trial", 'Stage'='Stage')) %>%
 distinct(Row, .keep_all =TRUE)
#write.csv(mwm_data, 'Merged_MWM_AWN_033123.csv')


# calculating normalized distances in each quadrant

mwm_data$Distance=mwm_data$Distance/10
mwm_data$NE_Distance=mwm_data$NE_Distance/10
mwm_data$NW_Distance=mwm_data$NW_Distance/10
mwm_data$SE_Distance=mwm_data$SE_Distance/10
mwm_data$SW_Distance=mwm_data$SW_Distance/10

#Normalize time and distance in target region
mwm_data$NormSWTime<-mwm_data$SW_Time/mwm_data$Duration
mwm_data$NormSWDist<-mwm_data$SW_Distance/mwm_data$Distance
mwm_data<-subset(mwm_data, (NormSWTime <= 1))

#Normalize Probe Distances
mwm_data$DistTot<-mwm_data$NE_Distance+mwm_data$NW_Distance+mwm_data$SE_Distance+mwm_data$SW_Distance
mwm_data$NE.Dist.Norm<-mwm_data$NE_Distance/mwm_data$DistTot
mwm_data$NW.Dist.Norm<-mwm_data$NW_Distance/mwm_data$DistTot
mwm_data$SE.Dist.Norm<-mwm_data$SE_Distance/mwm_data$DistTot
mwm_data$SW.Dist.Norm<-mwm_data$SW_Distance/mwm_data$DistTot

#Normalize Probe Times
mwm_data$TimeTot<-mwm_data$NE_Time+mwm_data$NW_Time+mwm_data$SE_Time+mwm_data$SW_Time
mwm_data$NE.Time.Norm<-mwm_data$NE_Time/mwm_data$TimeTot
mwm_data$NW.Time.Norm<-mwm_data$NW_Time/mwm_data$TimeTot
mwm_data$SE.Time.Norm<-mwm_data$SE_Time/mwm_data$TimeTot
mwm_data$SW.Time.Norm<-mwm_data$SW_Time/mwm_data$TimeTot

#Normalize time and distance in target region probe
mwm_data$NormSWTime<-mwm_data$SW_Time/mwm_data$Duration
mwm_data$NormSWDist<-mwm_data$SW_Distance/mwm_data$Distance
mwm_data<-subset(mwm_data, (NormSWTime <= 1))

# Converting NormSWDiet values to numeric
mwm_data$NormSWDist <- as.numeric(mwm_data$NormSWDist)
mwm_data$NormSWDist <- as.numeric(mwm_data$NormSWDist)



#write.csv(allMWM, '/Users/AnnaMacFarlane/Desktop/AllMWM_Combined.csv')


# merging with additional animal information
#index = match(  mice_info$BadeaID, mwm_data$AnimalID )
#sum(mice_info$BadeaID [index] != mwm_data$AnimalID)
#index = na.omit(index)
#temp= cbind(mwm_data[ index,],  mice_info)

# overwriting the merged data because this has updated ages at handling
#mwm_data<-read.csv('MWM_AWN_Combined 3.csv', header=TRUE)


```

```
hn_pooled_trials <- mwm_data %>% 
  filter(Genotype == "APOE22HN" | Genotype == "APOE33HN" | Genotype == "APOE44HN") %>% 
  filter(Stage != 'Probe_D5' & Stage != 'Probe_D8') %>% 
  #filter(!is.na(Genotype)) %>% 
  mutate(Coll_Geno = case_when(
    Genotype == 'APOE22' ~ '22 + 22HN',
    Genotype == 'APOE22HN' ~ '22 + 22HN',
    Genotype == 'APOE33' ~ '33 + 33HN',
    Genotype == 'APOE33HN' ~ '33 + 33HN',
    Genotype == 'APOE44' ~ '44 + 44HN',
    Genotype == 'APOE44HN' ~ '44 + 44HN'
  )) %>% 
  filter(!is.na(Age_group))

all_trials <- mwm_data %>% 
 # filter(Genotype == "APOE22HN" | Genotype == "APOE33HN" | Genotype == "APOE44HN") %>% 
  filter(Stage != 'Probe_D5' & Stage != 'Probe_D8') %>% 
  #filter(!is.na(Genotype)) %>% 
  mutate(Coll_Geno = case_when(
    Genotype == 'APOE22' ~ '22 + 22HN',
    Genotype == 'APOE22HN' ~ '22 + 22HN',
    Genotype == 'APOE33' ~ '33 + 33HN',
    Genotype == 'APOE33HN' ~ '33 + 33HN',
    Genotype == 'APOE44' ~ '44 + 44HN',
    Genotype == 'APOE44HN' ~ '44 + 44HN'
  )) %>% 
  filter(!is.na(Age_group))


hn_trials_ctrl<- hn_pooled_trials %>% 
  filter(Diet=='Control')

hn_trials_hfd<-hn_pooled_trials %>% 
  filter(Diet=='HFD')
  
  
  
probe_hn<-mwm_data %>% 
  filter(Genotype == "APOE22HN" | Genotype == "APOE33HN" | Genotype == "APOE44HN") %>% 
  filter(Stage == 'Probe_D5' | Stage == 'Probe_D8') %>% 
  filter(!is.na(Age_group))

e_trials <- mwm_data %>% 
  filter(Genotype == "APOE22" | Genotype == "APOE33" | Genotype == "APOE44") %>% 
  filter(Stage != 'Probe_D5' & Stage != 'Probe_D8') %>% 
  filter(!is.na(Age_group)) %>%
  filter(Diet != "") 
  


  
  
e_trials_ctrl <- e_trials%>% 
  filter(Diet=='Control')

e_trials_hfd <- e_trials %>% 
  filter(Diet=='HFD')
  
probe_e<-mwm_data %>% 
  filter(Genotype == "APOE22" | Genotype == "APOE33" | Genotype == "APOE44") %>% 
  filter(Stage == 'Probe_D5' | Stage == 'Probe_D8')  %>% 
  filter(!is.na(Age_group))
  
  
line_type<-mwm_data %>%
  mutate(Line_type = case_when(
    Genotype=='APOE22' ~ 'Basic',
    Genotype=='E22' ~ 'Basic',
    Genotype=='APOE22HN' ~ 'HN',
    Genotype=='APOE33' ~ 'Basic',
    Genotype=='APOE33HN' ~ 'HN',
    Genotype=='APOE44' ~ 'Basic',
    Genotype=='APOE44HN' ~ 'HN'
  )) %>% 
  filter(Stage != 'Probe_D5' & Stage != 'Probe_D8') %>% 
  filter(!is.na(Age_group)) %>%
  filter(Diet != "") 
  
  
    
probe_d5 <- mwm_data %>% 
  filter(Stage == 'Probe_D5') %>% 
  #filter(!is.na(Genotype)) %>% 
  mutate(Coll_Geno = case_when(
    Genotype == 'APOE22' ~ '22 + 22HN',
    Genotype == 'APOE22HN' ~ '22 + 22HN',
    Genotype == 'APOE33' ~ '33 + 33HN',
    Genotype == 'APOE33HN' ~ '33 + 33HN',
    Genotype == 'APOE44' ~ '44 + 44HN',
    Genotype == 'APOE44HN' ~ '44 + 44HN'
  )) %>% 
    filter(!is.na(Age_group))%>% 
    mutate(Line_type = case_when(
    Genotype=='APOE22' ~ 'Basic',
    Genotype=='E22' ~ 'Basic',
    Genotype=='APOE22HN' ~ 'HN',
    Genotype=='APOE33' ~ 'Basic',
    Genotype=='APOE33HN' ~ 'HN',
    Genotype=='APOE44' ~ 'Basic',
    Genotype=='APOE44HN' ~ 'HN'
  ))

  

probe_d8 <- mwm_data %>% 
  filter(Stage == 'Probe_D8') %>% 
  #filter(!is.na(Genotype)) %>% 
  mutate(Coll_Geno = case_when(
    Genotype == 'APOE22' ~ '22 + 22HN',
    Genotype == 'APOE22HN' ~ '22 + 22HN',
    Genotype == 'APOE33' ~ '33 + 33HN',
    Genotype == 'APOE33HN' ~ '33 + 33HN',
    Genotype == 'APOE44' ~ '44 + 44HN',
    Genotype == 'APOE44HN' ~ '44 + 44HN'
  )) %>% 
  filter(!is.na(Age_group))

#e2 <- mwm_wn %>% 
#  filter(Geno == "APOE22HN" | Geno == "APOE22")
#e3 <- mwm_wn %>% 
#  filter(Geno == "APOE33HN" | Geno == "APOE33")
#e4 <- mwm_wn %>% 
#  filter(Geno == "APOE44HN" | Geno == "APOE44")

all<-mwm_data %>% 
  filter(Stage != 'Probe_D5' & Stage != 'Probe_D8') %>% 
  filter(!is.na(Genotype)) %>% 
  mutate(Coll_Geno = case_when(
    Genotype == 'APOE22' ~ '22 + 22HN',
    Genotype == 'APOE22HN' ~ '22 + 22HN',
    Genotype == 'APOE33' ~ '33 + 33HN',
    Genotype == 'APOE33HN' ~ '33 + 33HN',
    Genotype == 'APOE44' ~ '44 + 44HN',
    Genotype == 'APOE44HN' ~ '44 + 44HN'
  )) %>% 
  filter(!is.na(Age_group)) 
  filter(Diet != "") 
  
  
  
  all<-mwm_data %>% 
  filter(Stage != 'Probe_D5' & Stage != 'Probe_D8') %>% 
  filter(!is.na(Genotype)) %>% 
  mutate(Coll_Geno = case_when(
    Genotype == 'APOE22' ~ '22 + 22HN',
    Genotype == 'APOE22HN' ~ '22 + 22HN',
    Genotype == 'APOE33' ~ '33 + 33HN',
    Genotype == 'APOE33HN' ~ '33 + 33HN',
    Genotype == 'APOE44' ~ '44 + 44HN',
    Genotype == 'APOE44HN' ~ '44 + 44HN'
  )) %>% 
  filter(Diet != "") 
  
  
  
all_stats_2<-mwm_data %>% 
  filter(Stage != 'Probe_D5' & Stage != 'Probe_D8') %>% 
  filter(Genotype != 'HN') %>%
  filter(!is.na(Genotype)) %>% 
  filter(!is.nan(Genotype)) %>% 
  filter(Genotype != "") %>%

#data frame for hn vs. non_hn  
mutate(Line_type = case_when(
    Genotype=='APOE22' ~ 'Basic',
    Genotype=='E22' ~ 'Basic',
    Genotype=='APOE22HN' ~ 'HN',
    Genotype=='APOE33' ~ 'Basic',
    Genotype=='APOE33HN' ~ 'HN',
    Genotype=='APOE44' ~ 'Basic',
    Genotype=='APOE44HN' ~ 'HN'
  )) %>% 
  mutate(Coll_Geno = case_when(
    Genotype == 'APOE22' ~ '22 + 22HN',
    Genotype == 'E22' ~ '22 + 22HN',
    Genotype == 'APOE22HN' ~ '22 + 22HN',
    Genotype == 'APOE33' ~ '33 + 33HN',
    Genotype == 'APOE33HN' ~ '33 + 33HN',
    Genotype == 'APOE44' ~ '44 + 44HN',
    Genotype == 'APOE44HN' ~ '44 + 44HN'
  ))

  
all_hn = all_hn[complete.cases(all_hn$Coll_Geno), ] 




```



```{r plots}

#hn vs. non_hn compared with normswdist
ggline(line_type, x = 'Stage', y='NormSWDist', 
       color='Line_type', fill='Line_type',
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top')
       
#hn vs. non_hn compared with normswdist, separated by genotype
ggline(all_stats_2, x = 'Stage', y='NormSWDist', 
       color='Line_type', fill='Line_type', facet.by=c('Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top')
       
       
#age compared to normswdist
ggline(e_trials, x='Stage', y='NormSWDist', 
       color='Age_group', fill='Age_group',
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top')


ggline(hn_pooled_trials, x='Stage', y='Distance', 
       color='Coll_Geno',
       error.plot='errorbar', add='mean_se', 
       palette = c("#1BCC97", "#1B50CC", "#CC1BA8"), size=1,
       point.size=1.5,  legend='top')   



ggline(e_trials, x='Stage', y='Distance', 
       color='Genotype', fill='Genotype', facet.by=c('Age_group','Sex'),
       error.plot='errorbar', add='mean_se', 
       palette = c("#1BCC97", "#1B50CC", "#CC1BA8"), size=1,
       point.size=1.5,  legend='top')    


ggline(e_trials, x='Stage', y='Distance', 
       color='Genotype', fill='Genotype', facet.by=c('Age_group'),
       error.plot='errorbar', add='mean_se', 
       palette = c("#1BCC97", "#1B50CC", "#CC1BA8"), size=1,
       point.size=1.5,  legend='top')    
       

ggline(e_trials, x='Stage', y='Distance', 
       color='Genotype', fill='Sex', facet.by=c('Sex'),
       error.plot='errorbar', add='mean_se', 
       palette = c("#1BCC97", "#1B50CC", "#CC1BA8"), size=1,
       point.size=1.5,  legend='top') 
       

ggline(e_trials, x='Stage', y='Distance', 
       color='Genotype', fill='Sex', facet.by=c('Sex'),
       error.plot='errorbar', add='mean_se', 
       palette = c("#1BCC97", "#1B50CC", "#CC1BA8"), size=1,
       point.size=1.5,  legend='top') 



ggline(e_trials, x='Stage', y='Distance', 
       color='Genotype', fill='Genotype', facet.by=c('Sex'),
       error.plot='errorbar', add='mean_se', 
       palette = c("#1BCC97", "#1B50CC", "#CC1BA8"), size=1,
       point.size=1.5,  legend='top') 
             
       

ggline(e_trials, x='Stage', y='NormSWDist', 
       color='Age_group', fill='Age_group',
       error.plot='errorbar', add='mean_se', 
       palette = c("#1BCC97", "#1B50CC", "#CC1BA8"), size=1,
       point.size=1.5,  legend='top') 
       

       
mutate(Line_type = case_when(
    Genotype=='APOE22' ~ 'Basic',
    Genotype=='E22' ~ 'Basic',
    Genotype=='APOE22HN' ~ 'HN',
    Genotype=='APOE33' ~ 'Basic',
    Genotype=='APOE33HN' ~ 'HN',
    Genotype=='APOE44' ~ 'Basic',
    Genotype=='APOE44HN' ~ 'HN'
  )) %>% 


plt1 <- ggbetweenstats(
  data = probe_d5,
  x = Sex,
  y = NormSWDist, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything",
)

plt1



plt2 <- ggbetweenstats(
  data = probe_d8,
  x = Sex,
  y = NormSWDist, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

plt2


plta <- ggbetweenstats(
  data = probe_d5,
  x = Age_group,
  y = NormSWDist, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

plta

pltb <- ggbetweenstats(
  data = probe_d8,
  x = Age_group,
  y = NormSWDist, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

pltb


probe_d5<-probe_d5 %>% 
  filter(Diet != "") 

probe_d8<-probe_d8 %>% 
  filter(Diet != "") 


pltc <- ggbetweenstats(
  data = probe_d5,
  x = Diet,
  y = NormSWDist, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

pltc



pltc <- ggbetweenstats(
  data = probe_d8,
  x = Diet,
  y = NormSWDist, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

pltc

pltd <- ggbetweenstats(
  data = probe_d5,
  x = Genotype_mastersheet,
  y = NormSWDist, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

pltd

plte <- ggbetweenstats(
  data = probe_d8,
  x = Genotype_mastersheet,
  y = NormSWDist, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

       
mutate(Line_type = case_when(
    Genotype=='APOE22' ~ 'Basic',
    Genotype=='E22' ~ 'Basic',
    Genotype=='APOE22HN' ~ 'HN',
    Genotype=='APOE33' ~ 'Basic',
    Genotype=='APOE33HN' ~ 'HN',
    Genotype=='APOE44' ~ 'Basic',
    Genotype=='APOE44HN' ~ 'HN'
  )) %>% 

pltf<- ggbetweenstats(
  data = probe_d5,
  x = Line_type,
  y = NormSWDist, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)


pltf

plt3 <- ggbetweenstats(
  data = probe_d5,
  x = Coll_Geno,
  y = Winding_numbers, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

plt3

plt4 <- ggbetweenstats(
  data = probe_d8,
  x = Coll_Geno,
  y = Winding_numbers, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

plt4


plt5 <- ggbetweenstats(
  data = probe_d5,
  x = Coll_Geno,
  y = NormSWDist, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

plt5



plt6 <- ggbetweenstats(
  data = probe_d8,
  x = Coll_Geno,
  y = NormSWDist, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

plt6

plt7 <- ggbetweenstats(
  data = probe_d5,
  x = Coll_Geno,
  y = Distance, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

plt7

plt8 <- ggbetweenstats(
  data = probe_d8,
  x = Coll_Geno,
  y = Distance, 
  pairwise.annotation = "p.value",
  pairwise.display = "everything"
)

plt8








png('output/test_plot.png')
par(mar = c(4.1, 4.4, 4.1, 1.9), xaxs="i", yaxs="i")
ggline(all, x='Stage', y='Distance',
       color='Age_group', fill='Age_group', 
       error.plot='errorbar', add='mean_se', 
       palette = c("#6a0dad", "#008000", "#FF0000"), size=1,
       point.size=1.5, legend='top') +
       stat_compare_means(aes(group = Age_group), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")
dev.off()



ggline(hn_trials_ctrl, x='Stage', y='Winding_numbers',
       color='Geno', fill='Geno', facet.by=c('Diet','Sex'),
       error.plot='errorbar', add='mean_se', 
       palette = c("#6a0dad", "#008000", "#FF0000"), size=1,
       point.size=1.5, legend='top')
       
# facet by age and sex
par(mfrow=c(1,1))
jpeg("basic_ctrl_facetAgeSex_AWN.jpeg", units="in", width=7, height=5, res=300)  

ggline(e_trials_ctrl, x='Stage', y='Winding_numbers', 
       color='Genotype', fill='Genotype', facet.by=c('Age_group','Sex'),
       error.plot='errorbar', add='mean_se', 
       palette = c("#1BCC97", "#1B50CC", "#CC1BA8"), size=1,
       point.size=1.5,  legend='top', title = 'Winding Number')
      
dev.off()
       
ggline(e_trials, x='Stage', y='Distance', 
       color='Genotype', fill='Genotype', facet.by=c('Age_group','Sex'),
       error.plot='errorbar', add='mean_se', 
       palette = c("#1BCC97", "#1B50CC", "#CC1BA8"), size=1,
       point.size=1.5,  legend='top')       

ggline(e_trials, x='Stage', y='NormSWDist', 
       color='Genotype', fill='Genotype', facet.by=c('Age_group','Sex'),
       error.plot='errorbar', add='mean_se', 
       palette = c("#1BCC97", "#1B50CC", "#CC1BA8"), size=1,
       point.size=1.5,  legend='top')



ggline(e_trials, x='Stage', y='NormSWDist', 
       color='Age_group', fill='Age_group', facet.by=c('Genotype'),
       error.plot='errorbar', add='mean_se', 
      palette = c("purple", "green"), size=1,
      point.size=1.5,  legend='top')



ggline(e_trials, x='Stage', y='NormSWDist', 
       color='Age_group', fill='Age_group',
       error.plot='errorbar', add='mean_se', 
       palette = c("#1BCC97", "#1B50CC", "#CC1BA8"), size=1,
       point.size=1.5,  legend='top')
              
# Just genotype, no facet  

all<-all %>% 
  mutate(Line_type = case_when(
    Genotype=='APOE22' ~ 'Basic',
    Genotype=='APOE22HN' ~ 'HN',
    Genotype=='APOE33' ~ 'Basic',
    Genotype=='APOE33HN' ~ 'HN',
    Genotype=='APOE44' ~ 'Basic',
    Genotype=='APOE44HN' ~ 'HN'
))

# single factor plots: updated color, fill, and stat_compare_means group to change
# what factor is being expressed

ggline(all, x='Stage', y='NormSWDist', 
       color='Diet', fill='Diet',
       error.plot='errorbar', add='mean_se', 
       palette = c('blue', 'orange', 'green'), size=1,
       point.size=1.5,  legend='top', title='Normalized SW Dist') +
       stat_compare_means(aes(group = Diet), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")
       
ggline(all, x='Stage', y='Winding_numbers', 
       color='Diet', fill='Diet',
       error.plot='errorbar', add='mean_se', 
       palette = c('blue', 'orange', 'green'),size=1,
       point.size=1.5,  legend='top', title='Winding Number') +
       stat_compare_means(aes(group = Diet), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")    
       
ggline(all, x='Stage', y='Distance', 
       color='Diet', fill='Diet',
       error.plot='errorbar', add='mean_se', size=1,
       palette = c('blue', 'orange', 'green'),
       point.size=1.5,  legend='top', title='Total Distance')  +
       stat_compare_means(aes(group = Diet), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")     
       
       
       
       

ggline(e2, x='Stage', y='Winding_numbers', 
       color='Genotype', fill='Genotype', facet.by=c('Diet','Sex'),
       error.plot='errorbar', add='mean_se', 
      palette = c("#1BCC97", "#6a0dad"), size=1,
       point.size=1.5,  legend='top')

ggline(e3, x='Stage', y='Winding_numbers', 
       color='Geno', fill='Geno', facet.by=c('Diet','Sex'),
       error.plot='errorbar', add='mean_se', 
       palette = c("#1B50CC", "#008000"), size=1,
       point.size=1.5,  legend='top')

ggline(e4, x='Stage', y='Winding_numbers', 
       color='Geno', fill='Geno', facet.by=c('Diet','Sex'),
       error.plot='errorbar', add='mean_se', 
       palette = c("#CC1BA8", "#FF0000"), size=1,
       point.size=1.5,  legend='top')
```

```{r facet-by-sex}
ggline(e_trials, x='Stage', y='Winding_numbers', 
       color='Sex', fill='Sex', facet.by=c('Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex') 
       
# facet by age and genotype
ggline(e_trials_ctrl, x='Stage', y='Winding_numbers', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex') +
       stat_compare_means(aes(group = Sex), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")
       
animal_counts<-distinct(mwm_data, Age_Substracted, .keep_all = TRUE)
table(mwm_data[mwm_data$Age_Substracted])

ggline(e_trials_ctrl, x='Stage', y='Distance', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex') +
       stat_compare_means(aes(group = Sex), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")
       
ggline(e_trials_ctrl, x='Stage', y='NormSWDist', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex') +
       stat_compare_means(aes(group = Sex), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")



# facet by sex and genotype 
       
ggline(e_trials_ctrl, x='Stage', y='Winding_numbers', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("purple", "green"), size=1,
       point.size=1.5,  legend='top', legend.title='Age Group', title='Winding Number') +
       stat_compare_means(aes(group = Age_group), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")
       
       
       #+ 
      #stat_compare_means(aes(group = Age_group), label = "p.signif", hide.ns=TRUE,
      # label.y = 20)

       
ggline(e_trials_ctrl, x='Stage', y='NormSWDist', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("purple", "green"), size=1,
       point.size=1.5,  legend='top', legend.title='Age Group', 
       title='Normalized SW Distance') +
       stat_compare_means(aes(group = Age_group), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")

ggline(e_trials_ctrl, x='Stage', y='Distance', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("purple", "green"), size=1,
       point.size=1.5,  legend='top', legend.title='Age Group', 
       title='Total Distance') +
       stat_compare_means(aes(group = Age_group), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")
       


# basic lines collapse age 

ggline(hn_trials_ctrl, x='Stage', y='Winding_numbers', 
       color='Sex', fill='Sex', facet.by=c('Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex', title='Winding Number') +
       stat_compare_means(aes(group = Sex), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")

ggline(hn_trials_ctrl, x='Stage', y='Distance', 
       color='Sex', fill='Sex', facet.by=c('Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex', title='Total Distance') +
       stat_compare_means(aes(group = Sex), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")
       
ggline(hn_trials_ctrl, x='Stage', y='NormSWDist', 
       color='Sex', fill='Sex', facet.by=c('Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex', title='Normalized SW Dist') +
       stat_compare_means(aes(group = Sex), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")   
       
# geno and age with diet lines within basic lines

ggline(e_trials, x='Stage', y='Winding_numbers', 
       color='Diet', fill='Diet', facet.by=c('Age_group', 'Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("blue", "orange", 'red'), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex', title='Winding Number') +
       stat_compare_means(aes(group = Diet), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")
       
       
       
# test
ggline(e_trials, x='Stage', y='Winding_numbers', 
       color='Diet', fill='Diet', facet.by=c('Age_group', 'Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("blue", "orange", 'red'), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex', title='Winding Number') +
       stat_compare_means(aes(group = Diet), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")
       

ggline(e_trials, x='Stage', y='Distance', 
       color='Diet', fill='Diet', facet.by=c('Age_group', 'Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("blue", "orange"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex', title='Total Distance') +
       stat_compare_means(aes(group = Diet), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")
       
ggline(e_trials, x='Stage', y='NormSWDist', 
       color='Diet', fill='Diet', facet.by=c('Age_group', 'Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("blue", "orange"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Diet', title='Normalized SW Dist') +
       stat_compare_means(aes(group = Diet), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")  
 
# basic lines collapse sex
ggline(hn_trials_ctrl, x='Stage', y='Winding_numbers', 
       color='Age_group', fill='Age_group', facet.by=c('Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("purple", "green"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Age Group', title='Winding Number') +
       stat_compare_means(aes(group = Age_group), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")   


ggline(e_trials_ctrl, x='Stage', y='Distance', 
       color='Age_group', fill='Age_group', facet.by=c('Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("purple", "green"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Age Group', title='Total Distance') +
       stat_compare_means(aes(group = Age_group), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")   

ggline(e_trials_ctrl, x='Stage', y='NormSWDist', 
       color='Age_group', fill='Age_group', facet.by=c('Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("purple", "green"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Age Group', title='Normalized SW Dist') +
       stat_compare_means(aes(group = Age_group), label = "p.signif", hide.ns=TRUE,
       label.y.npc = "bottom", label.x.npc = "left")   

       
 
# facet by age group, colored by genotype 

ggline(e_trials, x='Stage', y='Winding_numbers', 
       color='Genotype', fill='Genotype', facet.by=c('Age_group'),
       error.plot='errorbar', add='mean_se', 
       #palette = c("purple", "green"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Genotype', title='Winding Number')        
       
       
#animal_counts<-distinct(e_trials, AnimalID, .keep_all = TRUE)
#table(animal_counts[animal_counts$Genotype == 'APOE33', ]$Age_group)
```

```{r new-m-plots}
ggline(e_trials, x='Stage', y='NewM', 
       color='Genotype', fill='Genotype', facet.by=c('Diet','Sex'),
       error.plot='errorbar', add='mean_se', 
       palette = c("#1BCC97", "#1B50CC", "#CC1BA8"), size=1,
       point.size=1.5,  legend='top', legend.title='Sex')
       
       
stat.test <- e_trials_ctrl %>%
  group_by(Genotype) %>%
  #t_test(Winding_numbers ~ Sex) %>%
  nest() %>% 
mutate(
ttest=map(e_trials_ctrl,~ t_test(Winding_numbers ~ Sex, paired=F,data = .x))) %>%
      adjust_pvalue(method = "bonferroni") %>%
  adjust_pvalue(method = "bonferroni") %>%
  add_significance("p.adj")
stat.test
stat.test <- stat.test %>% add_xy_position(x = "Stage")


ggline(e_trials_ctrl, x='Stage', y='Winding_numbers', 
       color='Sex', fill='Sex', facet.by=c('Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex') + 
       stat_compare_means(aes(group = Sex), label = "p.signif")
       
       #stat.test,  label = "p.adj.signif", tip.length = 0.01)
       
       
       #stat_compare_means(method='anova', aes(group=Sex)) +
       #stat_compare_means(aes(label = after_stat(p.signif)),
                  #method = "t.test", ref.group = ".all.")
       #stat_compare_means(aes(group = Sex), label = "p.signif", 
                     #label.y = c(16, 25, 29))
       
ggline(e_trials, x='Stage', y='NewM', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex')
       
ggline(e_trials, x='Stage', y='NewM', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top', legend.title='Sex')

```

```{r all-geno}
ggline(all, x='Stage', y='Winding_numbers', 
       color='Sex', fill='Sex', facet.by=c('Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex')
       
ggline(all, x='Stage', y='Distance', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex')
       
ggline(all, x='Stage', y='NewM', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top', legend.title='Sex')
       
ggline(all, x='Stage', y='NormSWDist', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top', legend.title='Sex')
       
       
# Collapsed genotype and sex
ggline(all, x='Stage', y='Winding_numbers', 
       color='Coll_Geno', fill='Coll_Geno',
       error.plot='errorbar', add='mean_se', size=1,
       point.size=1.5,  legend='top',
       legend.title='Genotype') 

ggline(all, x='Stage', y='Distance', 
       color='Coll_Geno', fill='Coll_Geno',
       error.plot='errorbar', add='mean_se', size=1,
       point.size=1.5,  legend='top',
       legend.title='Genotype') 

ggline(all, x='Stage', y='NewM', 
       color='Coll_Geno', fill='Coll_Geno',
       error.plot='errorbar', add='mean_se', size=1,
       point.size=1.5,  legend='top',
       legend.title='Genotype') 
       
ggline(all, x='Stage', y='NormSWDist', 
       color='Coll_Geno', fill='Coll_Geno',
       error.plot='errorbar', add='mean_se', size=1,
       point.size=1.5,  legend='top',
       legend.title='Genotype') 
       
# Sex collapsed, combined HN and regular lines

ggline(all, x='Stage', y='Winding_numbers', 
       color='Sex', fill='Sex', facet.by=c('Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex') 
       
ggline(all, x='Stage', y='NewM', 
       color='Sex', fill='Sex', facet.by=c('Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex') 
       
ggline(all, x='Stage', y='Distance', 
       color='Sex', fill='Sex', facet.by=c('Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex') 
       
ggline(all, x='Stage', y='NormSWDist', 
       color='Sex', fill='Sex', facet.by=c('Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex') 

# Age collapsed, combined HN and regular lines 
ggline(all, x='Stage', y='Winding_numbers', 
       color='Age_group', fill='Age_group', facet.by=c('Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Age Group') 
       
ggline(all, x='Stage', y='NewM', 
       color='Age_group', fill='Age_group', facet.by=c('Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Age Group') 
       
ggline(all, x='Stage', y='Distance', 
       color='Age_group', fill='Age_group', facet.by=c('Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Age Group') 
       
ggline(all, x='Stage', y='NormSWDist', 
       color='Age_group', fill='Age_group', facet.by=c('Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Age Group') 
       
# Combined lines faceted by age and colored sex
ggline(all, x='Stage', y='Winding_numbers', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex')
       
ggline(all, x='Stage', y='NewM', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex')
       
ggline(all, x='Stage', y='Distance', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex')
       
ggline(all, x='Stage', y='NormSWDist', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex')
       
# Combined lines faceted by sex and colored age
ggline(all, x='Stage', y='Winding_numbers', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Age Group')
       
ggline(all, x='Stage', y='NewM', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Age Group')

ggline(all, x='Stage', y='Distance', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Age Group')

ggline(all, x='Stage', y='NormSWDist', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Coll_Geno'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Age Group')
       

ggline(all, x='Stage', y='NewM', 
       color='Coll_Geno', fill='Coll_Geno',
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple", 'blue'), size=1,
       point.size=1.5,  legend='top')
       
       
ggplot(data=all, aes(x=Stage, y=Winding_numbers, color=Age_group)) +
  geom_line(stat="identity", width=0.5) +
  facet_grid(Sex~Coll_Geno) + 
  #labs(y="Average Percent Freezing Time", x='Component') +
  #geom_errorbar(aes(ymin=len-se, ymax=len+se), width=0.2, size=0.5)+
  theme_bw()  
  #labs(title="Learning Curve", x="Time", 
  #     y='Mean Percent Time Freezing', 
  #     legend='Genotype') +
  #scale_x_continuous(breaks=c(1, 2, 3)) +
  #scale_color_manual(values = c("#6a0dad", "#1BCC97"))
```

```{r hn-line}

# HN lines faceted by sex and genotype, lines age

ggline(hn_trials, x='Stage', y='Winding_numbers', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex')
       
ggline(hn_trials, x='Stage', y='Distance', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex')

ggline(hn_trials, x='Stage', y='NormSWDist', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex')      

ggline(hn_trials, x='Stage', y='NewM', 
       color='Sex', fill='Sex', facet.by=c('Age_group','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top',
       legend.title='Sex')

# HN lines faceted by sex and genotype, lines age group
       
ggline(hn_pooled_trials, x='Stage', y='NewM', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top', legend.title='Sex')
 
 
# IMPORTANT       
ggline(hn_pooled_trials, x='Stage', y='NormSWDist', 
       color='Age_group', fill='Age_group', facet.by=c('Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("red", "blue"), size=1,
       point.size=1.5,  legend='top', legend.title='Age')
       
theme(
  axis.text.x = element_text(size = 100),      
  axis.text.y = element_text(100),     
  axis.title.x = element_text(size = 100),    
  axis.title.y = element_text(size = 100000)     
)

       

ggline(e_trials, x='Stage', y='NormSWDist', 
       color='Diet', fill='Diet', facet.by=c('Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("blue", "red"), size=1,
       point.size=1.5,  legend='top', legend.title='Diet')      
       
       
ggline(hn_pooled_trials, x='Stage', y='NormSWDist', 
       color='Sex', fill='Sex',
       error.plot='errorbar', add='mean_se', 
       palette = c("purple", "green"), size=1,
       point.size=1.5,  legend='top', legend.title='Sex')
       
ggline(hn_pooled_trials, x='Stage', y='NormSWDist', 
       color='Diet', fill='Diet',
       error.plot='errorbar', add='mean_se', 
       palette = c("orange", "pink"), size=1,
       point.size=1.5,  legend='top', legend.title='Diet')
       
ggline(hn_pooled_trials, x='Stage', y='NormSWDist', 
        color='Age_group', fill='Age_group', facet.by=c('Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("purple", "green"), size=1,
       point.size=1.5,  legend='top', legend.title='Diet')

ggline(hn_pooled_trials, x='Stage', y='NormSWDist', 
        color='Diet', fill='Diet',
       error.plot='errorbar', add='mean_se', 
       palette = c("green", "purple"), size=1,
       point.size=1.5,  legend='top', legend.title='Diet')
       
 
ggline(hn_pooled_trials, x='Stage', y='NormSWDist', 
        color='Coll_Geno', fill='Coll_Geno',
       error.plot='errorbar', add='mean_se', 
       palette = c("deeppink1", "darkorchid", "cadetblue3"), size=1,
       point.size=1.5,  legend='top', legend.title='Genotype')      
      

       
ggline(hn_trials, x='Stage', y='Winding_numbers', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("purple", "green"), size=1,
       point.size=1.5,  legend='top', legend.title='Sex')

ggline(hn_trials, x='Stage', y='Distance', 
       color='Age_group', fill='Age_group', facet.by=c('Sex','Genotype'),
       error.plot='errorbar', add='mean_se', 
       palette = c("purple", "green"), size=1,
       point.size=1.5,  legend='top', legend.title='Sex')
       
```

```{r probe-plots}
ggplot(data = probe_e, aes(factor(Age_group), NormSWDist)) +
  geom_violin() + geom_boxplot(width = 0.1) +
  theme_bw()+ facet_grid(.~Genotype) + 
  geom_jitter(height = 0, width = 0.3, size = 0.7, aes(color = Genotype)) +
  #labs(y = "Mean Percent Freezing Time", x='') +
  scale_color_manual(values = c("#1BCC97", "#1B50CC", "#CC1BA8")) #+
  #labs(title='Contextual Test')
  
ggplot(data = probe_e, aes(factor(Stage), Winding_numbers)) +
  geom_violin() + geom_boxplot(width = 0.1) +
  theme_bw()+ facet_grid(.~Genotype) + 
  geom_jitter(height = 0, width = 0.3, size = 0.7, aes(color = Genotype)) +
  #labs(y = "Mean Percent Freezing Time", x='') +
  scale_color_manual(values = c("#1BCC97", "#1B50CC", "#CC1BA8"))  
  
ggplot(data = probe_e, aes(factor(Stage), Distance)) +
  geom_violin() + geom_boxplot(width = 0.1) +
  theme_bw()+ facet_grid(Sex~Genotype) + 
  geom_jitter(height = 0, width = 0.3, size = 0.7, aes(color = Genotype)) +
  #labs(y = "Mean Percent Freezing Time", x='') +
  scale_color_manual(values = c("#1BCC97", "#1B50CC", "#CC1BA8"))    
  
  
  
ggplot(data = probe_e, aes(factor(Sex), NormSWDist)) +
  geom_violin() + geom_boxplot(width = 0.1) +
  theme_bw()+ facet_grid(Sex~Genotype) + 
  geom_jitter(height = 0, width = 0.3, size = 0.7, aes(color = Genotype)) +
  #labs(y = "Mean Percent Freezing Time", x='') +
  scale_color_manual(values = c("#1BCC97", "#1B50CC", "#CC1BA8")) 
  
ggplot(data = probe_d5 (drop = FALSE), aes(factor(Sex), NormSWDist)) +
  geom_violin() + geom_boxplot(width = 0.1) +
  theme_bw()+ facet_grid(Sex~Genotype) + 
  geom_jitter(height = 0, width = 0.3, size = 0.7, aes(color = Genotype)) +
  #labs(y = "Mean Percent Freezing Time", x='') +
  scale_color_manual(values = c("#1BCC97", "#1B50CC", "#CC1BA8"))    



# faceted by stage and age as factor
ggplot(data = probe_e, aes(factor(Age_group), Distance)) +
  geom_violin() + geom_boxplot(width = 0.1) +
  theme_bw()+ facet_grid(Stage~Genotype) + 
  geom_jitter(height = 0, width = 0.3, size = 0.7, aes(color = Genotype)) +
  #labs(y = "Mean Percent Freezing Time", x='') +
  scale_color_manual(values = c("#1BCC97", "#1B50CC", "#CC1BA8"))   

ggplot(data = probe_e, aes(factor(Age_group), Winding_numbers)) +
  geom_violin() + geom_boxplot(width = 0.1) +
  theme_bw()+ facet_grid(Stage~Genotype) + 
  geom_jitter(height = 0, width = 0.3, size = 0.7, aes(color = Genotype)) +
  #labs(y = "Mean Percent Freezing Time", x='') +
  scale_color_manual(values = c("#1BCC97", "#1B50CC", "#CC1BA8"))  
 
ggplot(data = probe_e, aes(factor(Age_group), NormSWDist)) +
  geom_violin() + geom_boxplot(width = 0.1) +
  theme_bw()+ facet_grid(Stage~Genotype) + 
  geom_jitter(height = 0, width = 0.3, size = 0.7, aes(color = Genotype)) +
  #labs(y = "Mean Percent Freezing Time", x='') +
  scale_color_manual(values = c("#1BCC97", "#1B50CC", "#CC1BA8"))   
  
  
  

  
```


```{r post-hoc-reg}
library(lmerTest)
# try bootstrapping
all<-all %>% 
  mutate(line_factor = case_when(
    Genotype == 'APOE22' ~ 0,
    Genotype == 'APOE22HN' ~ 1,
    Genotype == 'APOE33' ~ 0,
    Genotype == 'APOE33HN' ~ 1,m
    Genotype == 'APOE44' ~ 0,
    Genotype == 'APOE44HN' ~ 1
))


# AWN basic lines
mod_1_awn_basic<-lmer(Winding_numbers~factor(Coll_Geno)*Sex*Diet*Line_type*Age_group+Stage+(1|AnimalID), all_stats_2)
mix_1_wn<-emmeans(mod_1_awn_basic, "Coll_Geno", adjust = "Tukey")
#pairs(mod_1_awn_basic)
a1_a<-anova(mod_1_awn_basic)
a1_a

write.xlsx(a1_a, file = "AWN_behave.xlsx", sheet = 'training_anova')




# AWN
mod_1_wn<-lmer(Winding_numbers~factor(Coll_Geno)*Sex*Age_group+Stage+Line_type+(1|AnimalID), all_stats_2)
mix_1_wn<-emmeans(mod_1_wn, "Coll_Geno", adjust = "Tukey")
write.xlsx(mix_1_wn, file = "AWN_behave.xlsx", sheet = 'non-basic_emmeans', append = T)

write.xlsx(pairs(mix_1_wn), file = "AWN_behave.xlsx", sheet = 'non-basic_posthoc', append = T)

a1<-anova(mod_1_wn)
a1
write.xlsx(a1, file = "AWN_behave.xlsx", sheet = 'non-basic_anova', append = T)



# Total distance
mod_1_dist<-lmer(Distance~factor(Coll_Geno)*Sex*Age_group+Stage+Line_type+(1|AnimalID), all_stats_2)
mix_1_dist<-emmeans(mod_1_dist, "Coll_Geno", adjust = "Tukey")
write.xlsx(mix_1_wn, file = "AWN_behave.xlsx", sheet = 'total-distance_emmeans', append = T)

write.xlsx(pairs(mix_1_wn), file = "AWN_behave.xlsx", sheet = 'total-distance_posthoc', append = T)

pairs(mix_1_dist)
a2<-anova(mod_1_dist)
a2
write.xlsx(a1, file = "AWN_behave.xlsx", sheet = 'total-distance_anova', append = T)


# New Metric
mod_1_newM<-lmer(NewM~factor(Coll_Geno)*Sex*Age_group+Stage+Line_type+(1|AnimalID), all_stats_2)
mix_1_newM<-emmeans(mod_1_newM, "Coll_Geno", adjust = "Tukey")


pairs(mix_1_newM)
a3<-anova(mod_1_newM)
a3

# Norm SW Distance
mod_1_normSW<-lmer(NormSWDist~factor(Coll_Geno)*Sex*Age_group+Stage+Line_type+(1|AnimalID), all_stats_2)
mix_1_normSW<-emmeans(mod_1_normSW, "Coll_Geno", adjust = "Tukey")
write.xlsx(mix_1_wn, file = "AWN_behave.xlsx", sheet = 'normal-sw_emmeans', append = T)

write.xlsx(mix_1_wn, file = "AWN_behave.xlsx", sheet = 'normal-sw_posthoc', append = T)

pairs(mix_1_normSW)
a4<-anova(mod_1_normSW)
a4
write.xlsx(mix_1_wn, file = "AWN_behave.xlsx", sheet = 'normal-sw_anova', append = T)

# within day 5 and within day 8
mod_probe<-lmer(NormSWDist~factor(Coll_Geno)*Treatment.y+Stage, probe_trials)

mix_reg<-emmeans(mod_reg, "Coll_Geno", adjust = "Tukey")
mix_probe<-emmeans(mod_probe, "Coll_Geno", adjust = "Tukey")

pairs(mix_reg)
pairs(mix_probe)

a1<-anova(mod_reg)
a2<-anova(mod_probe)

a1
a2

#Repeated measures one-way ANOVA
res.aov <- aov(Distance ~ Diet, data = mwm_data)

mwm_data_age <- mwm_data %>% 
  filter(!is.nan(Age_mastersheet)) %>% 
  filter(!is.na(Age_mastersheet))



young_age <- 15

#young_age <- median(mwm_data_age$Age_mastersheet)


diet_filtered_young <- mwm_data_age %>% 
  filter(Diet == 'Control' | Diet == 'HFD')  %>% 
  filter(!is.nan(Diet)) %>% 
  filter(Age_mastersheet > young_age)

ggboxplot(diet_filtered_young, x = "Diet", y = "Distance", 
          color = "Diet", palette = c("#00AFBB", "#E7B800", "#FC4E07"),
          order = c("HFD", "Control"),
          ylab = "Distance", xlab = "Diet")
          

ggline(diet_filtered_young, x = "Diet", y = "Distance", 
       add = c("mean_se", "jitter"), 
       order = c("ctrl", "trt1", "trt2"),
       ylab = "Weight", xlab = "Treatment")





genotype_filtered <- mwm_data %>% 
  filter(Genotype == 'APOE22HN' | Genotype == 'APOE22HN' | Genotype == 'APOE33' 
  | Genotype == 'APOE33HN' | Genotype == 'APOE44' | Genotype == 'APOE44HN')  %>%
  


ggboxplot(genotype_filtered, x = "Genotype", y = "Distance", 
          color = "Genotype", palette = c("#8146C2", "#E7B800", "#FC4E07", "#80CDC1", "#F1B6DA",
          "#D01C8B"),
          order = c("APOE22", "APOE22HN", "APOE33", "APOE33HN", "APOE44", "APOE44HN"),
          ylab = "Distance", xlab = "Genotype")
          
          
ggline(mwm_data, x = "group", y = "weight", 
       add = c("mean_se", "jitter"), 
       order = c("ctrl", "trt1", "trt2"),
       ylab = "Weight", xlab = "Treatment")



levels

```
